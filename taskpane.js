/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var t={58394:function(t,e,n){t.exports=n.p+"eddf4b99ab2d2bec9eb3.css"},83718:function(t,e,n){t.exports=n.p+"06f90d6c1a2996289a21.svg"}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.m=t,n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t}(),n.b=document.baseURI||self.location.href,function(){function t(){var n,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function s(t,o,i,a){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return e(l,"_invoke",function(t,e,o){var i,a,s,c=0,l=o||[],f=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(t,e){return i=t,a=0,s=n,p.n=e,u}};function d(t,e){for(a=t,s=e,r=0;!f&&c&&!o&&r<l.length;r++){var o,i=l[r],d=p.p,m=i[2];t>3?(o=m===e)&&(s=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=d&&((o=t<2&&d<i[1])?(a=0,p.v=e,p.n=i[1]):d<m&&(o=t<3||i[0]>e||e>m)&&(i[4]=t,i[5]=e,p.n=m,a=0))}if(o||t>1)return u;throw f=!0,e}return function(o,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,m),a=l,s=m;(r=a<2?n:s)||!f;){i||(a?a<3?(a>1&&(p.n=-1),d(a,s)):p.n=s:p.v=s);try{if(c=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((r=(f=p.n<0)?s:t.call(e,p))!==u)break}catch(t){i=n,a=1,s=t}finally{c=1}}return{value:r,done:f}}}(t,i,a),!0),l}var u={};function c(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(e(r={},i,function(){return this}),r),d=f.prototype=c.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,e(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,e(d,"constructor",f),e(f,"constructor",l),l.displayName="GeneratorFunction",e(f,a,"GeneratorFunction"),e(d),e(d,a,"Generator"),e(d,i,function(){return this}),e(d,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:m}})()}function e(t,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}e=function(t,n,r,o){function a(n,r){e(t,n,function(t){return this._invoke(n,r,t)})}n?i?i(t,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[n]=r:(a("next",0),a("throw",1),a("return",2))},e(t,n,r,o)}function n(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function r(t){return function(){var e=this,r=arguments;return new Promise(function(o,i){var a=t.apply(e,r);function s(t){n(a,o,i,s,u,"next",t)}function u(t){n(a,o,i,s,u,"throw",t)}s(void 0)})}}var o="outlookSummarize.openAiKey",i={runButton:null,statusText:null,summaryContainer:null,todoList:null,fyiList:null,apiKeyInput:null,saveKeyButton:null,clearKeyButton:null,apiKeyStatus:null,settingsRoot:null,openSettingsButton:null,closeSettingsButton:null,settingsBackdrop:null},a=null;function s(){return(s=r(t().m(function e(){var n,r;return t().w(function(t){for(;;)switch(t.n){case 0:return n=document.getElementById("sideload-msg"),r=document.getElementById("app-body"),n&&(n.style.display="none"),r&&(r.style.display="flex"),i.runButton=document.getElementById("run"),i.statusText=document.getElementById("status"),i.summaryContainer=document.getElementById("summary"),i.todoList=document.getElementById("todo-list"),i.fyiList=document.getElementById("fyi-list"),i.apiKeyInput=document.getElementById("api-key-input"),i.saveKeyButton=document.getElementById("save-key"),i.clearKeyButton=document.getElementById("clear-key"),i.apiKeyStatus=document.getElementById("api-key-status"),i.settingsRoot=document.getElementById("settings"),i.openSettingsButton=document.getElementById("open-settings"),i.closeSettingsButton=document.getElementById("close-settings"),i.settingsBackdrop=i.settingsRoot?i.settingsRoot.querySelector(".settings__backdrop"):null,i.runButton&&i.runButton.addEventListener("click",N),i.saveKeyButton&&i.saveKeyButton.addEventListener("click",m),i.clearKeyButton&&i.clearKeyButton.addEventListener("click",g),i.openSettingsButton&&i.openSettingsButton.addEventListener("click",c),i.closeSettingsButton&&i.closeSettingsButton.addEventListener("click",l),i.settingsBackdrop&&i.settingsBackdrop.addEventListener("click",l),document.addEventListener("keydown",f),t.n=1,p();case 1:return t.n=2,N();case 2:return t.a(2)}},e)}))).apply(this,arguments)}function u(){return i.settingsRoot&&!i.settingsRoot.classList.contains("settings--hidden")}function c(){i.settingsRoot&&(u()||(a=document.activeElement instanceof HTMLElement?document.activeElement:null),i.settingsRoot.classList.remove("settings--hidden"),i.settingsRoot.setAttribute("aria-hidden","false"),i.apiKeyInput&&(i.apiKeyInput.focus(),i.apiKeyInput.select()))}function l(){i.settingsRoot&&(i.settingsRoot.classList.add("settings--hidden"),i.settingsRoot.setAttribute("aria-hidden","true"),a&&"function"==typeof a.focus&&a.focus(),a=null)}function f(t){"Escape"===t.key&&u()&&(t.preventDefault(),l())}function p(){return d.apply(this,arguments)}function d(){return(d=r(t().m(function e(){var n,r;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,R(o);case 1:(n=t.v)&&i.apiKeyInput&&(i.apiKeyInput.value=n,v("API key loaded.","success")),t.n=3;break;case 2:t.p=2,r=t.v,v("Unable to load saved key: ".concat(r.message),"error");case 3:return t.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=r(t().m(function e(){var n,r;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(i.apiKeyInput){t.n=1;break}return t.a(2);case 1:if(n=i.apiKeyInput.value.trim()){t.n=2;break}return v("Enter an API key before saving.","error"),i.apiKeyInput.focus(),t.a(2);case 2:return t.p=2,t.n=3,j(o,n);case 3:v("API key saved locally.","success"),t.n=5;break;case 4:t.p=4,r=t.v,v("Unable to save key: ".concat(r.message),"error");case 5:return t.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}function g(){return h.apply(this,arguments)}function h(){return(h=r(t().m(function e(){var n;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(i.apiKeyInput){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,C(o);case 2:i.apiKeyInput.value="",v("API key removed.","success"),t.n=4;break;case 3:t.p=3,n=t.v,v("Unable to remove key: ".concat(n.message),"error");case 4:return t.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";i.apiKeyStatus&&(i.apiKeyStatus.textContent=t||"",i.apiKeyStatus.classList.remove("error","success"),"error"===e?i.apiKeyStatus.classList.add("error"):"success"===e&&i.apiKeyStatus.classList.add("success"))}function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";i.statusText&&(i.statusText.textContent=t||"",i.statusText.classList.remove("error","success"),"error"===e?i.statusText.classList.add("error"):"success"===e&&i.statusText.classList.add("success"))}function w(t){i.runButton&&(i.runButton.disabled=t,function(t,e){if(t){var n=t.querySelector("[data-button-label]");n?n.textContent=e:t.textContent=e}}(i.runButton,t?"Summarizing...":"Summarize email"))}function k(){i.summaryContainer&&(i.summaryContainer.hidden=!0)}function S(t){i.summaryContainer&&i.todoList&&i.fyiList&&(B(i.todoList,t.todo),B(i.fyiList,t.fyi),i.summaryContainer.hidden=!1)}function B(t,e){if(t){if(t.innerHTML="",!e.length){var n=document.createElement("li");return n.textContent="Nothing to report.",n.classList.add("summary-list__empty"),void t.appendChild(n)}e.forEach(function(e){var n=document.createElement("li");n.textContent=e,t.appendChild(n)})}}function I(t){return t.length<=6e3?{text:t,truncated:!1}:{text:t.slice(0,6e3),truncated:!0}}function E(t){return new Promise(function(e,n){t&&t.body?t.body.getAsync(Office.CoercionType.Text,function(t){t.status===Office.AsyncResultStatus.Succeeded?e(t.value||""):n(new Error(t.error?t.error.message:"Unknown error retrieving email body."))}):e("")})}function O(t){return x.apply(this,arguments)}function x(){return(x=r(t().m(function e(n){var r,o,i,a,s,u,c,l,f,p,d,m;return t().w(function(t){for(;;)switch(t.n){case 0:return r=n.apiKey,o=n.subject,i=n.from,a=n.body,s=n.truncated,u=["Subject: ".concat(o||"(no subject)"),i?"From: ".concat(i):null,s?"Note: The email body was truncated for length. Base the summary on the provided content only.":null,"Email body:",a].filter(Boolean),c={model:"gpt-3.5-turbo",temperature:.2,max_tokens:300,messages:[{role:"system",content:'You help busy people process email. Always respond with strictly valid JSON using the shape {"todo":[],"fyi":[]} where each array contains short sentence strings. Never include any additional commentary.'},{role:"user",content:"Summarize the email into actionable to-do items and FYI notes."},{role:"user",content:u.join("\n")}]},t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(c)});case 1:return l=t.v,t.n=2,l.text();case 2:f=t.v,p=null;try{p=JSON.parse(f)}catch(t){}if(l.ok){t.n=3;break}throw d=p&&p.error&&p.error.message?p.error.message:l.statusText,new Error("OpenAI request failed (".concat(l.status,"): ").concat(d));case 3:if(m=p&&p.choices&&p.choices[0]&&p.choices[0].message?p.choices[0].message.content:null){t.n=4;break}throw new Error("OpenAI response did not include summary content.");case 4:return t.a(2,m)}},e)}))).apply(this,arguments)}function K(t){var e=t.indexOf("{"),n=t.lastIndexOf("}");if(-1===e||-1===n)throw new Error("Model response was not valid JSON.");var r,o=t.slice(e,n+1);try{r=JSON.parse(o)}catch(t){throw new Error("Unable to parse model response.")}var i={};return Object.keys(r).forEach(function(t){i[t.toLowerCase()]=r[t]}),{todo:L(i.todo),fyi:L(i.fyi)}}function L(t){return t?Array.isArray(t)?t.map(function(t){return String(t).trim()}).filter(function(t){return t.length>0}):"string"==typeof t?t.split(/\r?\n/).map(function(t){return t.trim()}).filter(function(t){return t.length>0}):[]:[]}function R(t){return T.apply(this,arguments)}function T(){return(T=r(t().m(function e(n){return t().w(function(t){for(;;)switch(t.n){case 0:if("undefined"==typeof OfficeRuntime||!OfficeRuntime.storage){t.n=1;break}return t.a(2,OfficeRuntime.storage.getItem(n));case 1:return t.a(2,window.localStorage.getItem(n))}},e)}))).apply(this,arguments)}function j(t,e){return A.apply(this,arguments)}function A(){return(A=r(t().m(function e(n,r){return t().w(function(t){for(;;)switch(t.n){case 0:if("undefined"==typeof OfficeRuntime||!OfficeRuntime.storage){t.n=1;break}return t.a(2,OfficeRuntime.storage.setItem(n,r));case 1:window.localStorage.setItem(n,r);case 2:return t.a(2)}},e)}))).apply(this,arguments)}function C(t){return P.apply(this,arguments)}function P(){return(P=r(t().m(function e(n){return t().w(function(t){for(;;)switch(t.n){case 0:if("undefined"==typeof OfficeRuntime||!OfficeRuntime.storage){t.n=1;break}return t.a(2,OfficeRuntime.storage.removeItem(n));case 1:window.localStorage.removeItem(n);case 2:return t.a(2)}},e)}))).apply(this,arguments)}function N(){return _.apply(this,arguments)}function _(){return(_=r(t().m(function e(){var n,r,i,a,s,u,l,f;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return w(!0),b("Summarizing the email..."),k(),t.p=1,t.n=2,R(o);case 2:if(n=t.v){t.n=3;break}return b("Add your OpenAI API key in settings before summarizing.","error"),v("No API key saved.","error"),c(),t.a(2);case 3:if(r=Office.context.mailbox.item){t.n=4;break}throw new Error("No email selected.");case 4:return i=r.subject||"",a=r.from&&(r.from.displayName||r.from.emailAddress)?[r.from.displayName,r.from.emailAddress].filter(Boolean).join(" "):"",t.n=5,E(r);case 5:if(s=t.v,u=s.trim()){t.n=6;break}return b("This email does not contain readable content to summarize.","error"),t.a(2);case 6:return l=I(u),t.n=7,O({apiKey:n,subject:i,from:a,body:l.text,truncated:l.truncated});case 7:S(K(t.v)),b(l.truncated?"Summary ready (email truncated for length).":"Summary ready.","success"),t.n=9;break;case 8:t.p=8,f=t.v,console.error(f),b("Unable to summarize email: ".concat(f.message),"error"),k();case 9:return t.p=9,w(!1),t.f(9);case 10:return t.a(2)}},e,null,[[1,8,9,10]])}))).apply(this,arguments)}Office.onReady(function(t){t.host===Office.HostType.Outlook&&function(){return s.apply(this,arguments)}().catch(function(t){return console.error("Failed to initialize task pane",t)})})}(),new URL(n(58394),n.b),new URL(n(83718),n.b)}();
//# sourceMappingURL=taskpane.js.map